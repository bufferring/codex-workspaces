```
â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—
â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—    â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•
â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—   â•šâ–ˆâ–ˆâ–ˆâ•”â• 
â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•   â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— 
â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘    â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â• â–ˆâ–ˆâ•—
 â•šâ•â•â•â•â•â• â•šâ•â•  â•šâ•â•â•â•â•šâ•â•â•â•â•â•â•â•šâ•â•     â•šâ•â•  â•šâ•â•     â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•
    Dockerized Workspace Setup (Security-Enhanced)
    Tailscale â€¢ Nginx â€¢ code-server â€¢ Multi-user
==================================================
```

# UNEFA Codex - Sistema de Espacios de Trabajo Dockerizados con Code-Server

![VersiÃ³n](https://img.shields.io/badge/versiÃ³n-3.0.0-blue.svg)
![Shell](https://img.shields.io/badge/shell-bash-green.svg)
![Licencia](https://img.shields.io/badge/licencia-MIT-orange.svg)
![Plataforma](https://img.shields.io/badge/plataforma-ubuntu%2022.04-purple.svg)
![Docker](https://img.shields.io/badge/docker-20.10+-2496ED.svg?logo=docker&logoColor=white)

**Idiomas:** [ğŸ‡¬ğŸ‡§ English](README.md) | [ğŸ‡ªğŸ‡¸ EspaÃ±ol](README.es.md)

Un sistema listo para producciÃ³n que ejecuta mÃºltiples espacios de trabajo aislados de code-server usando Docker, Nginx y Tailscale.

## ğŸ—ï¸ Arquitectura

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SISTEMA HOST                            â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   Tailscale  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚          Nginx              â”‚   â”‚
â”‚  â”‚    Funnel    â”‚         â”‚      (Puerto 80)            â”‚   â”‚
â”‚  â”‚  (PÃºblico)   â”‚         â”‚                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚  / â†’ PÃ¡gina de Inicio       â”‚   â”‚
â”‚                           â”‚  /user1/ â†’ 127.0.0.1:8081   â”‚   â”‚
â”‚                           â”‚  /user2/ â†’ 127.0.0.1:8082   â”‚   â”‚
â”‚                           â”‚  ...                         â”‚   â”‚
â”‚                           â”‚  /user20/ â†’ 127.0.0.1:8100  â”‚   â”‚
â”‚                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                      â”‚                       â”‚
â”‚                                      â–¼                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚      CONTENEDOR DOCKER (codex-workspaces)              â”‚ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚ â”‚
â”‚  â”‚  â”‚ user1    â”‚  â”‚ user2    â”‚  ...  â”‚ user20   â”‚        â”‚ â”‚
â”‚  â”‚  â”‚ :8081    â”‚  â”‚ :8082    â”‚       â”‚ :8100    â”‚        â”‚ â”‚
â”‚  â”‚  â”‚code-     â”‚  â”‚code-     â”‚       â”‚code-     â”‚        â”‚ â”‚
â”‚  â”‚  â”‚server    â”‚  â”‚server    â”‚       â”‚server    â”‚        â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”‚  Todos los espacios en UN contenedor                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                           â”‚                                  â”‚
â”‚                           â–¼                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚     ~/codex/users/ (Almacenamiento Persistente)        â”‚ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”‚  user1/  user2/  user3/  ...  user20/                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Componentes:** Nginx (proxy inverso) + Tailscale (exposiciÃ³n pÃºblica) en host â†’ Contenedor Docker con instancias de code-server â†’ Almacenamiento persistente

---

## ğŸš€ Inicio RÃ¡pido

### Prerequisitos
- Docker, Nginx, Tailscale (autenticado)
- `curl`, `unzip`
- Ubuntu 22.04 LTS recomendado

### InstalaciÃ³n

```bash
chmod +x codex-setup.sh
sudo ./codex-setup.sh
```

**Se te pedirÃ¡ elegir:**
1. **ConfiguraciÃ³n Completa (Tailscale acceso pÃºblico):** URL pÃºblica a travÃ©s de Tailscale (`https://app.ts.net`)
2. **ConfiguraciÃ³n Red Local (solo LAN):** Acceso por IP de la red (`http://192.168.x.x`)
3. **Desinstalar (Eliminar todo):** Elimina servicios Codex, datos y configuraciones

### Modos de Uso

**OpciÃ³n 1: ConfiguraciÃ³n Completa (Tailscale acceso pÃºblico)**
- HTTPS seguro mediante funnel de Tailscale
- Accesible desde cualquier lugar con tu cuenta Tailscale
- Solicita un dominio tipo `miapp.ts.net`

**OpciÃ³n 2: ConfiguraciÃ³n Red Local (solo LAN)**
- HTTP estÃ¡ndar servido Ãºnicamente en la red local
- Detecta automÃ¡ticamente la IP del servidor (editable si es necesario)
- No requiere Tailscale ni internet; acceso via `http://<IP-SERVIDOR>/`

**OpciÃ³n 3: Desinstalar (Eliminar todo)**
- Detiene servicios systemd y elimina contenedor/imagen Docker
- Borra configuraciÃ³n de Nginx, datos de usuarios y archivos auxiliares
- Obliga a escribir `YES` para confirmar la eliminaciÃ³n irreversible

### InstalaciÃ³n No Interactiva (CI/CD)

```bash
export CODEX_NUM_USERS=15
export CODEX_DOMAIN="myapp.ts.net"
sudo -E ./codex-setup.sh
```

---

## ğŸ’» Lenguajes Pre-instalados

| Lenguaje | VersiÃ³n | Herramientas |
|----------|---------|--------------|
| **Python** | 3.10+ | pip, venv, pipenv, poetry, black, flake8 |
| **Node.js** | 22.12.0 LTS (NVM) | Bun (recomendado), npm, yarn, pnpm, TypeScript, ESLint, Prettier, nodemon |
| **Node.js (Actual)** | 24.x Current | Disponible vÃ­a NVM (`nvm use 24`) |
| **Go** | 1.25.5 | go mod, go build, go test |
| **Rust** | Ãšltima (rustup) | cargo, rustc |
| **C++** | Toolchain GCC | g++, make, build-essential |
| **C#** | .NET SDK 8.0 | CLI `dotnet`, plantillas de consola/web |

**TambiÃ©n incluye:** Git, build-essential, gcc/g++, wget, curl, code-server, perfiles NVM, administrador de cargas de .NET

**Proyectos soportados:** React, Vue, Flask, Django, Express, FastAPI, APIs REST, herramientas CLI, ciencia de datos, y mÃ¡s

---

## ğŸ” Credenciales de Espacios de Trabajo

- Espacio de trabajo 1: `user1` / `user1-pass`
- Espacio de trabajo 2: `user2` / `user2-pass`
- ...y asÃ­ sucesivamente

---

## ğŸ›¡ï¸ Seguridad y Aislamiento

**Aislamiento por Usuario Unix:**
- Cada espacio de trabajo se ejecuta como usuario Linux dedicado (`user1`-`user30`)
- Sin acceso root dentro de los espacios de trabajo
- Los usuarios pueden VER otros espacios (solo lectura) pero NO PUEDEN ELIMINAR archivos fuera del suyo

**Permisos:**
- Propio espacio: Lectura/escritura/eliminaciÃ³n completa
- Otros espacios: Solo lectura
- Archivos del sistema: Solo lectura

**PruÃ©balo:**
```bash
docker exec -it codex-workspaces su - user1
whoami  # Muestra: user1
rm /bin/ls  # Permiso denegado
```

---

## ğŸ›ï¸ AdministraciÃ³n

### Ver Estado
```bash
systemctl status codex-workspaces
docker ps | grep codex
```

### Reiniciar Servicios
```bash
sudo systemctl restart codex-workspaces
```

### Ver Registros
```bash
docker logs -f codex-workspaces
journalctl -xeu codex-workspaces
```

### DesinstalaciÃ³n Completa
```bash
sudo ./codex-setup.sh
# Elige opciÃ³n 3: Desinstalar (Eliminar todo)
# Escribe 'YES' para confirmar
```

**Lo que se elimina:**
- Todos los datos de espacios de trabajo
- Contenedor e imagen Docker
- Configuraciones de Nginx
- Servicios systemd
- Tailscale funnel

---

## ğŸ”§ ConfiguraciÃ³n

Edita las variables antes de la instalaciÃ³n o usa variables de entorno:

```bash
CODEX_NUM_USERS=25        # NÃºmero de espacios (1-30)
CODEX_DOMAIN="app.ts.net" # Tu dominio Tailscale
```

**Para cambiar configuraciÃ³n:** Vuelve a ejecutar el script con nuevos valores. La limpieza es automÃ¡tica.

---

## ğŸ› SoluciÃ³n de Problemas

| Problema | SoluciÃ³n |
|----------|----------|
| Contenedor no ejecutÃ¡ndose | `sudo systemctl restart codex-workspaces` |
| Error 502 Bad Gateway | Verifica que el contenedor estÃ© activo: `docker ps` |
| Conflictos de puertos | Verifica que los puertos 8081-81XX estÃ©n disponibles |
| Errores de permisos | Los espacios se ejecutan como usuarios Unix (por diseÃ±o) |

**Ver registros:**
```bash
docker logs --tail 50 codex-workspaces
journalctl -xeu codex-workspaces --no-pager -n 50
```

---

## ğŸ“Š Compatibilidad

| Componente | Requisito |
|-----------|-----------|
| **SO** | Ubuntu 22.04 LTS |
| **Docker** | 20.10+ |
| **Nginx** | 1.18+ |
| **Tailscale** | Cualquier versiÃ³n reciente |

**VersiÃ³n:** v3.0.0 (Seguridad Mejorada)  
**Lanzamiento:** Diciembre 2025

### ActualizaciÃ³n desde v1.x

```bash
# Respaldar datos (opcional)
sudo cp -r ~/codex/users ~/codex-backup

# Ejecutar instalaciÃ³n (limpieza automÃ¡tica)
sudo ./codex-setup.sh
```

**Cambios importantes:** Aislamiento por usuario Unix agregado en v3.0.0

---

## ğŸ“‚ Estructura del Repositorio

```
codex-workspaces/
â”œâ”€â”€ codex-setup.sh          # Script principal de instalaciÃ³n/orquestaciÃ³n
â”œâ”€â”€ src/                    # UI React + Tailwind del asistente de escritorio
â”œâ”€â”€ public/                 # Recursos estÃ¡ticos (workspaces.json, manifest, iconos)
â”œâ”€â”€ src-tauri/              # Backend Tauri en Rust y configuraciÃ³n de empaquetado
â”œâ”€â”€ dist/                   # Salida de Vite (generada)
â”œâ”€â”€ node_modules/           # Dependencias del proyecto (generadas)
â”œâ”€â”€ package.json            # Manifiesto del workspace Vite/Tauri
â”œâ”€â”€ tailwind.config.js      # Tokens de diseÃ±o Tailwind
â”œâ”€â”€ vite.config.ts          # ConfiguraciÃ³n de Vite + PWA
â”œâ”€â”€ README.md               # DocumentaciÃ³n en inglÃ©s
â””â”€â”€ README.es.md            # DocumentaciÃ³n en espaÃ±ol
```

### DiseÃ±o aprovisionado en el host

Tras ejecutar `codex-setup.sh`, el servidor queda organizado bajo `~/codex/`:

```
~/codex/
â”œâ”€â”€ landing/                # Selector de espacios servido por Nginx
â”œâ”€â”€ users/                  # Directorios home user1 â€¦ userN
â””â”€â”€ docker/                 # Dockerfile y scripts generados automÃ¡ticamente
```

---

## ğŸ–¥ï¸ AplicaciÃ³n de Escritorio

El asistente de escritorio integrado simplifica la ejecuciÃ³n de `codex-setup.sh` y el acceso a los espacios.

### Requisitos

- Bun (recomendado) o Node.js 18+ con npm disponible
- Toolchain de Rust + `cargo install tauri-cli`

### Instalar dependencias

```bash
bun install
```

### Desarrollo

```bash
# Ejecuta Vite + Tauri juntos
bun run tauri:dev

# Vista previa solo en navegador (opcional)
bun run dev
```

La interfaz usa por defecto la copia de `codex-setup.sh` en la raÃ­z del repositorio. Ajusta el campo de ruta si decides moverlo.

### Construir paquetes de escritorio

```bash
# Compila los assets de producciÃ³n
bun run build

# Genera bundles para Linux (AppImage, deb, rpm) y el binario
bun run tauri:build

# Genera solo el ejecutable Linux (sin AppImage/deb/rpm)
bun run tauri build --bundles none
```

Los ejecutables quedan en `src-tauri/target/release/`.

---

## ğŸŒ Red y Puertos

- **Nginx:** Puerto 80 (host)
- **Code-server:** Puertos 8081-81XX (dentro del contenedor, usando `--network host`)
- **Tailscale:** HTTPS vÃ­a funnel

---

## ğŸ“– Recursos Adicionales

**Script Principal:**
- `codex-setup.sh` - Multi-modo: Completa (1), Limpieza (2), o Local (3)

**Uso:**
```bash
sudo ./codex-setup.sh
# OpciÃ³n 1: ConfiguraciÃ³n Completa (Tailscale)
# OpciÃ³n 2: Modo Red Local (solo LAN)
# OpciÃ³n 3: Desinstalar (Eliminar todo)
```

Toda la configuraciÃ³n vÃ­a prompts interactivos o variables de entorno (`CODEX_NUM_USERS`, `CODEX_DOMAIN`).

---

## ğŸ“œ Licencia

Licencia MIT - Copyright (c) 2025 Buffer Ring Organization

Ver archivo [LICENSE](LICENSE) para mÃ¡s detalles.

## ğŸ‘¥ CrÃ©ditos

**Desarrollado por [BufferRing](https://github.com/BufferRing)**  
Sitio web: [bufferring.org](https://bufferring.org)

**Proyecto Comunitario:** Esta es una herramienta educativa de cÃ³digo abierto puesta a disposiciÃ³n gratuita de estudiantes y profesores. No estÃ¡ oficialmente respaldada ni afiliada a ninguna instituciÃ³n o entidad gubernamental.

